#!/bin/bash

# üéØ COMPREHENSIVE TESTING STRATEGY FOR YOUR PRODUCTION APP

echo "üß™ COMPREHENSIVE TESTING GUIDE"
echo "=============================="
echo ""

echo "Your Django app is now production-ready! Here's how to test everything:"
echo ""

echo "üîß STEP 1: BASIC DEVELOPMENT TESTING"
echo "------------------------------------"
echo ""
echo "1a. Test Django Backend:"
echo "   cd back"
echo "   python manage.py check"
echo "   python manage.py runserver"
echo "   # Then visit: http://localhost:8000/api/health/"
echo ""

echo "1b. Test Frontend:"
echo "   cd front"
echo "   npm install  # if not already done"
echo "   npm run dev"
echo "   # Then visit: http://localhost:3000"
echo ""

echo "üê≥ STEP 2: DOCKER TESTING"
echo "-------------------------"
echo ""
echo "2a. Test Individual Services:"
echo "   # Backend Docker test:"
echo "   docker build -t hammer-backend ./back"
echo "   docker run -p 8001:8000 hammer-backend"
echo "   # Visit: http://localhost:8001/api/health/"
echo ""
echo "   # Frontend Docker test:"
echo "   docker build -t hammer-frontend ./front"
echo "   docker run -p 3001:3000 hammer-frontend"
echo "   # Visit: http://localhost:3001"
echo ""

echo "2b. Test Full Production Stack:"
echo "   docker-compose -f docker-compose.prod.yml up --build"
echo "   # Visit: http://localhost (served by Nginx)"
echo ""

echo "üîç STEP 3: HEALTH CHECK TESTING"
echo "-------------------------------"
echo ""
echo "3a. API Health Check:"
echo "   curl http://localhost:8000/api/health/"
echo "   # Should return: {\"status\": \"healthy\", ...}"
echo ""
echo "3b. API Documentation:"
echo "   curl http://localhost:8000/api/info/"
echo "   # Should return list of available endpoints"
echo ""

echo "üõ°Ô∏è STEP 4: SECURITY TESTING"
echo "----------------------------"
echo ""
echo "4a. Test Security Headers:"
echo "   curl -I http://localhost/api/health/"
echo "   # Should include: X-Frame-Options, X-Content-Type-Options"
echo ""
echo "4b. Test Rate Limiting (when Nginx is running):"
echo "   for i in {1..15}; do curl http://localhost/api/health/; done"
echo "   # Should see 429 errors after ~10 requests"
echo ""

echo "üìä STEP 5: PERFORMANCE TESTING"
echo "------------------------------"
echo ""
echo "5a. Static File Serving:"
echo "   curl -I http://localhost/static/"
echo "   # Should be served by Nginx (faster than Django)"
echo ""
echo "5b. Database Connection Pool:"
echo "   # Multiple concurrent API requests"
echo "   for i in {1..10}; do curl http://localhost/api/students/ & done"
echo ""

echo "üöÄ STEP 6: DEPLOYMENT TESTING"
echo "-----------------------------"
echo ""
echo "6a. Environment Configuration:"
echo "   # Make sure .env.production exists with real values"
echo "   # Test with production settings"
echo ""
echo "6b. Full Deployment Test:"
echo "   ./deploy.sh"
echo "   # This runs the full production deployment"
echo ""

echo "üéØ QUICK TESTING COMMANDS"
echo "========================="
echo ""
echo "For immediate testing, run these commands:"
echo ""

echo "# 1. Quick Django test:"
echo "cd back && python manage.py runserver &"
echo "sleep 3"
echo "curl http://localhost:8000/api/health/"
echo "kill %1"
echo ""

echo "# 2. Quick Docker test:"
echo "docker-compose -f docker-compose.prod.yml up -d"
echo "sleep 10"
echo "curl http://localhost/api/health/"
echo "docker-compose -f docker-compose.prod.yml down"
echo ""

echo "# 3. Quick frontend test:"
echo "cd front && npm run build"
echo ""

echo "‚úÖ WHAT TO EXPECT"
echo "=================="
echo ""
echo "üü¢ WORKING SIGNS:"
echo "- Django starts without errors"
echo "- Health endpoint returns JSON with 'status': 'healthy'"
echo "- Frontend builds and loads"
echo "- Docker images build successfully"
echo "- Nginx serves requests on port 80"
echo ""
echo "üî¥ ERROR SIGNS TO WATCH FOR:"
echo "- ModuleNotFoundError (missing dependencies)"
echo "- Database connection errors"
echo "- CORS errors in browser console"
echo "- Docker build failures"
echo "- 500 Internal Server errors"
echo ""

echo "üìö DETAILED GUIDES"
echo "=================="
echo ""
echo "For comprehensive testing instructions:"
echo "- TESTING_GUIDE.md - Step-by-step manual testing"
echo "- JUNIOR_DEVELOPER_GUIDE.txt - Technical explanations"
echo "- Docker logs: docker logs <container-name>"
echo "- Django logs: back/logs/django.log"
echo ""

echo "üéâ READY FOR PRODUCTION!"
echo "========================"
echo ""
echo "If all tests pass, your app is ready for production deployment!"
echo "Run: ./deploy.sh"
echo ""

echo "Need help? Check the troubleshooting section in TESTING_GUIDE.md"
